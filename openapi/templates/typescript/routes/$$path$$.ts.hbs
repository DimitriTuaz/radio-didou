/** Loopback 4 - OpenApi Route: {{operation_name}} **/

import request from 'superagent';
import { OpenAPI } from '..'

{{#each operation as | operation |}}
    {{#each operation.path as | path |}}
        {{#if path.x-operation-name}}
            {{#if @../first}}
export namespace {{{path.x-controller-name}}} {
            {{/if}}
        {{#each path.responses as | response |}}
            {{#if @first}}
                {{#each response.content as | content |}}
                {{#if content.schema}}

                    {{#if content.schema.items}}
    export function {{{path.x-operation-name}}}(): Promise<{{content.schema.items.title}}[]> {
        return new Promise<{{content.schema.items.title}}[]>(async (resolve, reject) => {
                        try {
                const response = await request
                    .{{@../../key}}(OpenAPI.URL + '{{operation.path_name}}');
                resolve(response.body);
            } catch (error) {
                reject(error);
            }
        });
    }
                    {{else}}
    export function {{{path.x-operation-name}}}(): Promise<{{content.schema.title}}> {
        return new Promise<{{content.schema.title}}>(async (resolve, reject) => {
                        try {
                const response = await request
                    .{{@../../key}}(OpenAPI.URL + '{{operation.path_name}}');
                resolve(response.body);
            } catch (error) {
                reject(error);
            }
        });
    }
                    {{/if}}
                {{/if}}
                {{/each}}
            {{/if}}
        {{/each}}
        {{/if}}
    {{/each}}
{{/each}}
}
